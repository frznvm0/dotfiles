#!/bin/sh

bat(){
  percent=$(acpi -b | cut -d ',' -f 2 | sed 's/\s//')
  icon="\uE03B"
  if [ -n "$(acpi -b | grep Discharging)" ]; then
    if [ ${percent%?} -le 25 ]; then
      icon="\uE038"
    elif [ ${percent%?} -le 50 ]; then
      icon="\uE039"
    elif [ ${percent%?} -le 75 ]; then
      icon="\uE03A"
    fi
    echo -e "$icon $percent"
  else
    echo -e "\uE041"
  fi
}

cpu(){
  read cpu a b c previdle rest < /proc/stat
  prevtotal=$((a+b+c+previdle))
  sleep 0.5
  read cpu a b c idle rest < /proc/stat
  total=$((a+b+c+idle))
  percent="$((100*( (total-prevtotal) - (idle-previdle) ) / (total-prevtotal) ))"
  echo -e "\uE026 $percent%"
}

tempr(){
  echo -e "\uE01D $(acpi -t | cut -d ' ' -f 4)Â°"
}

mem(){
  used=$(free -m | awk '/^Mem/ {print $3}')
  echo -e "\uE028 ${used}MiB"
}

net(){
  ifaces=$(ip -o link show up | grep -v NO-CARRIER | grep -v lo)
  echo -en "\uE048 "
  test -z "$ifaces" && echo "- " && return
  echo "$ifaces" | cut -d' ' -f2 | cut -d: -f1 | tr '\n' ' '
}

mails(){
  echo -e "\uE103 $(ls -1 ~/mail/INBOX/new | wc -l)"
}

vol(){
  echo -e "\uE05D $(amixer get Master | tail -1 | sed -r 's/.*\[(.*)%\].*/\1/')%"
}

while true; do
  xsetroot -name "$(bat)  $(cpu)  $(tempr)  $(mem)  $(net) $(mails)  $(vol)  \
$(echo -e "\uE015") $(date +%H:%M)"
  sleep 2s
done

